# ****

## 怎么写好软件（框架、组件、专项）设计方案



------





# **一、前言**

本文将描述一个好的软件设计方案应该具体哪些特征，包括哪些内容等，以及怎么去推进软件设计。

不论是推进软件设计，还是推进普通的事情，通常需要关注三点：

1. 事情成立的合理性
2. 做事方式的科学性
3. 事情结果的正确性

上述三点转化成四个通俗的问题：

1. “我”要做什么？
2. 别人是怎么做？
3. “我”准备怎么做？
4. “我”怎么证明它是对的？

进一步地，四个通俗问题结合软件领域，转化成如下：

1. 设计目标：要做什么

2. 1. 要解决的问题是什么？
   2. 从问题出发，目标是什么？问题和目标之间的逻辑是否成立？
   3. 将目标拆解开去，有哪些指标能够量化目标的完成情况？

3. 技术方案对比：之前、别人怎么做？

4. 1. 横向对比业界、公司内、部门内既有方案
   2. 纵向与自身历史对比

5. 设计方案构成：我要怎么做

6. 1. 架构全景图：厘清自身与周边系统的关系
   2. 内部设计：遵守四个设计原则
   3. 设计考量：性能等影响要素
   4. 关键技术挑战：识别技术风险

7. 验证方案构成：事后怎么让你相信方案是正确的，并且成功实施了

8. 1. 明确哪些数据，怎么去收集、上报、统计
   2. 基于上述数据，开展AB Test，控制除方案之外的一切变量进行对比
   3. 基于上述数据，参照自身的历史数据，进行纵向对比
   4. 基于上述数据，参照同类业务，进行横向对比



------





# **二、怎么做好“设计目标”**

古往今来，但凡是兴兵打仗，都讲究师出有名，哪怕是主动挑起战端，也要打着“替天行道”的旗帜，标榜自己是正义之师。

虽然开展一项技术活动，并非是要“战火纷飞”，但也从来不是兴趣使然，率性而为，是有着明确的导向。

## **2.1 问题是什么**

要说服干系人，--在公司内主要为Boss、Team Leader等，同意你做某个事情，首先要说明问题的严重性或者紧迫性，从而佐证做这个事情的必要性。

说明问题可以从两个角度入手，一方面是业务，另一方面是技术。例如，当我们发起性能优化的时候，就可以从当前用户体验比较卡顿等进行说明。

## **2.2 目标是什么**

把目标说成“解决问题”，是一个很笼统、很偷懒的说法。问题很多时候体现为某某现象，目标则是解决深层次的直接或根本原因。

常言“无利不起早”，这里的“利”也就是“目标”，可以从收益去讲，即业务收益、技术收益，摆明足够的收益，就更加显得这个事情的必要性了。

此时，笼统的目标可以起到鼓舞人心的效果，但是详尽的目标可以让人看到更清晰的收益，会更加让干系人放行。



------





# **三、怎么做好“技术方案对比”**

相信一个事实，你肯定不是第一个遇到上述问题的，也肯定不是第一个提出上述目标的，因此耐心地进行技术方案对比，从而找到突破口是很有必要的。

同时，干系人也不会没有道理地，也不应该盲目地采信你提出的技术方案，一般都会在意你是不是在闭门造车。

## **3.1 横向对比：与别人比较**

横向对比就是要从空间的角度发起对比，此处的“别人”包括三类：业界、大腾讯、TME。

技术圈子有着“文人相轻”的臭风气，并且越是限制圈子范围，研发人员之间交集越多，“相轻”的情况越严重。然而，河海不择细流，故能就其深，优秀的人总会虚心、耐心地找到别人的闪光点。

横向对比通常需要不小的调研工作，这个过程需要注意分类，问题的解决方法不少，但其中的原理不多，一般以原理为维度，选择1-3个原理就足够了，再在这些原理下挑选典型的实现方案1-2个即可。

## **3.2 纵向对比：与历史对比**

纵向对比是历史的、当前的方案进行比较，此时不要将自己与前任同事摆在对立面上，否定历史，否定当下，并不见得你比前任有多高明。需要明白，因为时过境迁，你所面对的情况，持有的条件，几乎不同于你的前任，因此首先摆正好姿态。

阐述纵向对比，可以加入制定方案的约束条件的考虑，例如从前选择某某缓存组件，而现在团队加入了自行实现的网络能力，缓存组件又不能很好的整合它，于是此时，这就是它的不足，从而也就是你新方案的优势。



------





# **四、怎么做好“设计方案构成”**

牢记一个道理，没有最牛逼的，只有最合适的。此时此刻所做的最合适的决策，在彼时彼刻可能就不再是了。

设计方案的构成，可以看成四个部分：

## **4.1 （架构）全景图**

就像是做一个事情，需要弄清楚这个事情卷入了哪些人，也就是干系人，有些是直接的，有些是间接的，哪些是受益的，哪些是受损的。在引入或者改动某个技术行为前，也需要分析受影响的有哪些系统，也就是理清楚自身与周边系统的关系。--这里的“系统”是一类泛称，可以是运维视角里的某个平台，也可以是客户端研发视角里的某个组件或者模块。

例如当我们引入Quic来替换TCP，就需要搞清楚除了APP之外，还有哪些系统需要卷入，例如CGI网关，CDN存储等等。同样，当我们打算替换掉APP内的网络引擎组件时，需要关注播放组件、下载组件等等

最好的方式是用图像化的方式，展现清楚自身与环境的关系，也只有这样，才能让避免一叶遮目，只见树木，不见森林。不仅让自己的视野更清楚，也让参与其中的协作者、评审者更加清晰你的意图，更好评估影响范围。

## **4.2 设计约束**

如3.2节，当前所做的决策是因应当前的诉求、条件、情况等，这些就是你的设计约束。通常这些约束典型体现为技术指标上的要求，例如成功率、内存占用、CPU开销等。

以替换播放引擎为例，团队要求替换后所有播放类技术指标没有发生劣化，甚至要求10%到20%的提升。

## **4.3 详细/概要设计**

传统的软件流程对详细/概要软件设计非常看重，但是随着互联网公司氛围里，特别是接受过敏捷开发思想熏陶的团队里，对这两类设计非常鄙夷。

但是不论是先设计后开发，还是“撸起袖子”直接开搞，需要记得尽可能遵守五个设计原则，也就是SOLID五原则：

1. 单一职责原则
2. 开放封闭原则
3. 里氏替换原则
4. 接口分离原则
5. 依赖倒置原则

## **4.4 技术风险**

技术上的信任并不是那么容易建立的，如果只是拍着胸脯说，“你放心”，那么起码我是不会放心的。

研发几乎不会一帆风顺，因此意识到其中的技术风险，识别到关键的技术挑战，并进行预研，或者制定Plan B，是必要的。通常良好的设计是一定会覆盖这些的。



------





# **五、怎么做好“验证方案构成”**

（软件）研发是一个科学行为，具备科学可验证的特质。“王婆卖瓜，自卖自夸”，这般停留在语言层面的自我证明，是经不起技术推敲的。要证明方案最后的效果，需要带着量化的数据去比较参照物。

## **5.1 数据证明**

如在4.2节所说，需要明确哪些数据来证明实施效果，例如业务层面的点击率、留存率、曝光率等，技术层面的成功率、内存、CPU开销等。

同时，记得说明怎么去收集、上报、统计这些数据，把这些事情阐述情况，即便是别人去执行验证，也可以照着你的文字去实施。

## **5.2 对比证明**

最好的证明，就是让别人开口，因此证明方案的结果，可以参考三个做法：

1. 基于上述数据，开展AB Test，控制除方案之外的一切变量进行对比
2. 基于上述数据，参照自身的历史数据，进行纵向对比
3. 基于上述数据，参照同类业务，进行横向对比



------





# **六、总结**

从发起、（对比）分析、设计，到验证，这四个部分构成了技术方案书，尽管它看起来比较“套路式”，但是不妨先“模仿”执行，等到你的功力达到了炉火纯青，再别出心裁也不迟。